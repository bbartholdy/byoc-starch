# Results

```{r setup-res, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
#opts_knit$set(root.dir = '/Users/username/path_to_project')
#corr_counts <- readr::read_csv(here("analysis/data/derived_data", "corr_counts.csv"))
#corr_comb <- readr::read_csv(here("analysis/data/derived_data", "corr_comb.csv"))
#sol_corr <- readr::read_csv(here("analysis/data/derived_data", "sol_corr.csv"))
#source(here("analysis/scripts/analysis.R"))
#source(here("analysis/scripts/tables.R"))
#source(here("analysis/scripts/figures.R"))
#source(c("tables.R", "figures.R", "analysis.R"))
#code to include R scripts in .Rmd: r knitr::spin_child("tables.R")
```


All samples yielded sufficient biofilm growth and starch incorporation to be 
included in the analysis, resulting in a total of 48 biofilm samples (two plates of 24),
45 of which were used for analysis (three samples were set aside for separate analysis).
Most control samples contained no starch granules, while some contained negligible
quantities (supp. mat).

## No amylase activity detected in the model

<!-- insert amylase results -->


## Treatment type had no effect on biofilm growth

```{r anova-tbl}
knitr::kable(anova_tbl, 
             col.names = c("Treatment", "Mean", "SD", "Min", "Max"),
             caption = "Summary statistics for biofilm dry-weights (in mg) by treatment.")
```

A one-way ANOVA suggests that the type of starch used during the biofilm 
growth period had a minimal effect on the growth of the biofilm 
(expressed as total dry weight of the sample), F(`r paste(treat_df[1], treat_df[2], sep = ", ")`)
= `r treat_f.stat`, p = `r treat_p`. 
A summary of sample weights is available in Table \@ref(tab:anova-tbl).

## Starch counts

<!-- starch counts in the solutions -->

```{r solution-count-out}
count_sol_out <- count_sol %>%
  mutate(across(c(s, m, l, total), 
                function(x) 
                  paste0(round(x), " (", scales::percent(x / total, 0.1), ")")))

### adding the 'both' row to the data frame ###
count_sol_comb_out <- count_sol_comb %>%
  mutate(across(c(s, m, l, total), 
                function(x) 
                  paste0(round(x), " (", scales::percent(x / total, 0.1), ")")))

count_sol_out <- count_sol %>%
  mutate(across(c(s, m, l, total), 
                function(x) 
                  paste0(round(x), " (", scales::percent(x / total, 0.1), ")"))) %>%
  ungroup() %>%
  add_row(tibble_row(count_sol_comb_out), .before = 3)
```


```{r solution-count-tbl}
cnames <- c("Solution", "Starch", "Small (%)", "Medium (%)", "Large (%)", "Total (%)")
knitr::kable(count_sol_out, col.names = cnames, 
             caption = "Mean starch counts from solutions, including the
             proportional makeup of the different sizes of granules.")
```

<!-- starch counts in the samples -->

```{r sample-count}
count_sample <- count_sample %>%
  ungroup() %>%
  add_row(count_sample_comb, .after = 2)

# convert columns to contain mean count and percentage of total count
count_samp_per <- count_sample %>%
  mutate(across(c(s, m, l, total), 
                function(x) 
                  paste0(round(x), " (", scales::percent(signif(x / total, 3)), ")")))

# count_samp_comb_per <- count_sample_comb %>%
#   mutate(across(c(s, m, l, total), 
#                 function(x) 
#                   paste0(round(x), " (", scales::percent(x / total, 0.1), ")")))

# count_samp_comb_out <- tibble(count_samp_comb_per, count_sample_comb_sd, .name_repair = "unique") %>%
#   select(1,2,3,7,4,8,5,9,6,10) #%>%
  #add_row(tibble_row(count_sample_comb_out), .before = 3)

count_samp_out <- tibble(count_samp_per, count_sample_sd, .name_repair = "unique") %>%
  select(1,2,3,7,4,8,5,9,6,10) #%>%
  #add_row(tibble_row(count_sample_comb_out), .before = 3)
```


```{r sample-count-tbl}
cnames <- c("Treatment", "Starch", "Small (%)", "SD", "Medium (%)", "SD", 
            "Large (%)", "SD", "Total (%)", "SD")
knitr::kable(count_samp_out, col.names = cnames, 
             caption = "Mean starch counts extracted from samples with standard 
             deviation (SD), including the proportion of granule sizes of the total count.")
```

It was not possible to differentiate between potato and 
wheat starches smaller than ca. 10 $\mu$m,
small potato starches were counted as wheat starches in the mixed-treatment samples. This is reasonable given that the small potato granules make up an insignificant proportion of the 
total count of small granules within mixed-treatment solutions which are predominantly
wheat granules
(`r paste0(signif((count_sol$s[4] / sum(c(count_sol$s[3], count_sol$s[4]))) * 100, 3), "%")`).
<!-- count of small granules from wheat solution divided by the sum of small granules 
from the potato and wheat solutions -->

<!-- absolute solution counts compared to absolute sample counts. does exposure
to higher quantities of starches mean more incorporated starches? -->
The separate wheat and potato solutions were made with a 0.25% (w/v) starch
concentration, while the mixed-starch solution was made with 0.25% (w/v) of each
starch, with a total concentration of 0.50% (w/v).
The mixed-treatment had the highest absolute count of starch granules in solution,
while the biofilms exposed to the wheat solution preserved the greatest number of
granules. The potato treatment had the lowest absolute counts in both the solution 
and in the biofilm samples <!-- insert counts? -->
(Tables \@ref(tab:solution-count-tbl) and \@ref(tab:sample-count-tbl)).

<!-- look at proportions of incorporated starches in each sample before looking at overall means -->

### Proportion of available starches incorporated in samples

```{r sample-perc}
# convert proportions to percent labels
perc_comb <- prop_comb %>% 
  mutate(across(c(s, m, l, total), scales::percent, 0.001)) 

perc <- prop %>%
  mutate(across(c(s, m, l, total), scales::percent, 0.001)) %>% 
  add_row(tibble_row(perc_comb), .before = 3)
```


```{r sample-prop-tbl}
cnames <- c("Treatment", "Starch", "Small", "Medium", "Large", "Total")
knitr::kable(perc, col.names = cnames, 
             caption = "The mean percentage of starches from the solutions that 
              were incorported into the samples.")
```

The proportion of total starches from the solutions that were incorporated 
into the samples ranged from 
`r paste(min(perc$total), max(perc$total), sep = " to ")`,
with potato granules being more readily incorporated than wheat in both the
separated- and mixed-treatment samples
(Table \@ref(tab:sample-prop-tbl)). 
There is an inverse relationship between the absolute starch count in the solutions 
and the proportional incorporation of starches in the biofilm samples, i.e. potato 
had the lowest absolute count in solutions, but the highest proportional 
incorporation, and vice versa for the mixed treatment.

<!-- separated treatments -->


<!-- mixed treatments -->
Wheat incorporation was most affected in the mixed-treatment samples, with only
`r paste0(perc$total[2])` of the total available starches being incorporated into
the sample, compared to
`r paste0(perc$total[4])`
in the separated wheat treatment.

### Size ratios differ between solutions and samples

<!-- size proportions -->
<!-- pie charts -->

```{r sep-plot, fig.cap="(A) Proportion (%) of sizes of starch granules in the wheat solution (outer ring) and extracted from the wheat-treatment samples (inner ring), and (B) in the potato solution (outer ring) and extracted from the potato-treatment samples (inner ring). l = large, m = medium, s = small."}
#plot_grid(pl_wheat1, pl_potato1, labels = c("A", "B"), label_y = 0.1)
pl_wheat1 + pl_potato1 + plot_layout(guides = "collect") + plot_annotation(tag_levels = "A")
```

<!-- change colour of medium starches in D to match C -->
```{r mix-plot, fig.cap="Proportion of sizes of (A) wheat granules in the mixed solution (outer ring) and extracted from the wheat-treatment samples (inner ring), and sizes of (B) potato granules in the solution (outer ring) and extracted from the potato-treatment samples (inner ring). l = large, m = medium, s = small."}
#plot_grid(pl_wheat2, pl_potato2, labels = c("C", "D"), label_y = 0.1)
pl_wheat2 + pl_potato2 + plot_layout(guides = "collect") + plot_annotation(tag_levels = "A")
```
<!-- Combine to a single figure? -->

<!-- overall size trends -->

Overall, medium starch granules had a higher mean rate of incorporation 
(`r scales::percent(mean(prop$m, na.rm = T), 0.001)`) 
than small 
(`r scales::percent(mean(prop$s, na.rm = T), 0.001)`) 
and large 
(`r scales::percent(mean(prop$l, na.rm = T), 0.001)`) 
starch granules across all treatments, while large potato starches had the lowest 
rate of incorporation across all treatments.

<!-- separated and mixed treatments -->
The difference in incorporation between the size categories resulted in a change
in size ratios between the original starch solutions and the extracted samples.
Large potato granules (> 20 $\mu$m) were most affected, with a 
`r paste0(abs(diff_sep$potato[3]), "%")` 
decrease in relative abundance in the potato-only treatment, and a
`r paste0(abs(diff_mix$potato[3]), "%")` 
decrease in mixed treatments. Medium granules increased in relative abundance 
across all samples, while small granules decreased in wheat treatments and 
increased in potato treatments 
(Figures \@ref(fig:sep-plot) and \@ref(fig:mix-plot)). 

<!-- Chi square test for size counts? -->

<!-- Proportion and size ratios are the most important points to be made -->

### Biofilm weight correlated positively with extracted starch counts

```{r cor, echo=FALSE}
# prepare cor output for reporting
cor_r <- signif(count_cor$estimate, 3)
cor_ci <- signif(count_cor$conf.int, 3)
cor_p <- if(count_cor$p.value > 0.001){
  signif(count_cor$p.value, 3)
} else {
  paste("< 0.001")
}

cor2_r <- signif(starch_cor$estimate, 3)
cor2_ci <- signif(starch_cor$conf.int, 3)
cor2_p <- if(starch_cor$p.value > 0.001){
  signif(starch_cor$p.value, 3)
} else {
  paste("< 0.001")
}
# Convert r correlation result to text
direct_cor <- ifelse(cor_r < 0, "negative", "positive")
strength_cor <- if(cor_r >= 0.8){
  "very strong"
} else if(cor_r < 0.8 & cor_r >= 0.6){
  "strong"
} else if(cor_r < 0.6 & cor_r >= 0.4){
  "moderate"
} else if(cor_r < 0.4 & cor_r >= 0.2){
  "weak"
} else{
  "very weak"
}
```

```{r cor-plot, warning=FALSE, fig.cap="Scatter plot of sample weight and standardised starch count by Z-score for seprated treatments."}
pl_cor
```
<!-- with Z-score standardisation -->

Pearson's *r* suggests a 
`r strength_cor` `r direct_cor` 
correlation between the total weight of the biofilms and the total starch count 
(standardised by z-score) extracted from the samples across treatments, 
*r* = `r cor_r`, 
90%CI[`r paste(cor_ci[1], cor_ci[2], sep = ", ")`],
p = `r cor_p`
(Figure \@ref(fig:cor-plot)). 

The same test was applied to total biofilm weight and starch count per mg 
calculus (also standardised by z-score), resulting in a weak positive correlation, 
*r* = `r cor2_r`, 
90%CI[`r paste(cor2_ci[1], cor2_ci[2], sep = ", ")`],
p `r cor2_p`
(Figure \@ref(fig:cor-plot2)).

<!-- size ratios in the larger deposits vs the smaller deposits?
  Are larger starches more proportionately represented in larger deposits?
  -->
  
```{r cor-plot2, warning=FALSE, fig.cap="Scatter plot of sample weight in mg and standardised count of starch grains per mg calculus."}
pl_cor2
```

